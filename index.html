<?php
/**
 * نظام كريم تراز لإدارة خدمات السوشيال ميديا
 * Karim Traz SMM API Client
 */

class KarimTrazApi
{
    /** رابط المزود الرسمي */
    public $api_url = 'https://smmapro.com/api/v2';

    /** مفتاح الـ API الخاص بك - ضعه بين الفاصلتين */
    public $api_key = 'ضع_مفتاحك_هنا'; 

    /** إضافة طلب جديد باسم كريم تراز */
    public function order($data)
    {
        $post = array_merge(['key' => $this->api_key, 'action' => 'add'], $data);
        return json_decode((string)$this->connect($post));
    }

    /** فحص حالة الطلب عبر لوحة كريم */
    public function status($order_id)
    {
        return json_decode(
            $this->connect([
                'key' => $this->api_key,
                'action' => 'status',
                'order' => $order_id
            ])
        );
    }

    /** فحص رصيدك الحالي في لوحة Karim Traz */
    public function getMyBalance()
    {
        return json_decode(
            $this->connect([
                'key' => $this->api_key,
                'action' => 'balance',
            ])
        );
    }

    /** جلب قائمة خدمات كريم تراز */
    public function services()
    {
        return json_decode(
            $this->connect([
                'key' => $this->api_key,
                'action' => 'services',
            ])
        );
    }

    private function connect($post)
    {
        $_post = [];
        if (is_array($post)) {
            foreach ($post as $name => $value) {
                $_post[] = $name . '=' . urlencode($value);
            }
        }

        $ch = curl_init($this->api_url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_POST, 1);
        curl_setopt($ch, CURLOPT_HEADER, 0);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);

        if (is_array($post)) {
            curl_setopt($ch, CURLOPT_POSTFIELDS, join('&', $_post));
        }
        curl_setopt($ch, CURLOPT_USERAGENT, 'Karim Traz API Agent 1.0');
        $result = curl_exec($ch);
        if (curl_errno($ch) != 0 && empty($result)) {
            $result = false;
        }
        curl_close($ch);
        return $result;
    }
}

// --- مثال على التشغيل بنظام كريم تراز ---

$karimApi = new KarimTrazApi();

// 1. جلب الرصيد
$myBalance = $karimApi->getMyBalance();
echo "رصيد لوحة كريم تراز الحالي هو: " . $myBalance->balance . " " . $myBalance->currency;

// 2. إرسال طلب جديد تلقائياً
/*
$newOrder = $karimApi->order([
    'service' => 1, // رقم الخدمة من الموقع المزود
    'link' => 'https://facebook.com/karim.traz',
    'quantity' => 100
]);
*/
?>
